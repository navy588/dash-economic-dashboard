name: Multiple Daily Data Updates

permissions:
  contents: write    # ì»¤ë°‹ & í‘¸ì‹œ ê¶Œí•œ

on:
  schedule:
    - cron: '0 21 * * *'   # KST 06:00 (UTC 21:00)
    - cron: '0 0  * * *'   # KST 09:00 (UTC 00:00)
    - cron: '0 3  * * *'   # KST 12:00 (UTC 03:00)
    - cron: '0 6  * * *'   # KST 15:00 (UTC 06:00)
  workflow_dispatch:     # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  update-data:
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
        with:
          persist-credentials: true

      - name: Python ì„¸íŒ…
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: pip install -r requirements.txt

      - name: ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤í–‰
        run: python update_data.py

      - name: ë³€ê²½ëœ pickle ìŠ¤í…Œì´ì§• & ì»¤ë°‹
        run: |
          # Git ì‚¬ìš©ì ì„¤ì • (ì•¡ì…˜ì—ì„œ ì»¤ë°‹í•  ë•Œ í•„ìš”)
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          # ìƒì„±ëœ latest_data.pklë§Œ ìŠ¤í…Œì´ì§•
          git add latest_data.pkl
          # ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ì»¤ë°‹, ì—†ìœ¼ë©´ ë¬´ì‹œ
          git commit -m "chore: update latest_data.pkl" || echo "ğŸš€ no changes to commit"

      - name: ë³€ê²½ í‘¸ì‹œ
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
          force: true
